<div
  class="mobile container md:hidden "
  x-data="{messageModel:  <%= im_open %> , imageUploadModal:false, receiverInfo:false, open: false}"
>
  <div
    x-show="receiverInfo"
    class="
      receiverInfo
      fixed
      w-full
      h-full
      top-0
      left-0
      z-50
      bg-white
      overflow-hidden
      px-3
      pt-5
    "
    x-show="receiverInfo"
  >
    <div class="flex items-center justify-start text-left pl-5">
      <div
        @click="receiverInfo = false"
        class="rounded-full text-center"
        style="line-height: 3rem"
      >
        <i
          class="zmdi zmdi-arrow-left text-gray-400"
          style="font-size: 27px"
        ></i>
      </div>
      <h3
        class="font-bold text-indigo-500 text-md pl-4 -mt-2"
        style="line-height: 3rem"
      >
        Back
      </h3>
    </div>
    <div class="mt-4 rounded bg-gray-100 py-8 px-3 u_detailsn">
      <h3 class="font-bold text-lg text-gray-500">No Date Available</h3>
    </div>

    <div class="mt-4 u_details">
      <div class="text-center">
        <img
          class="
            inline-block
            h-24
            w-24
            min-w-24
            rounded-full
            ring-2 ring-white
            receiverImage
          "
          src=""
          alt=""
        />
        <h3 class="font-bold text-xl mt-3 receiverName">Aratin Kolix</h3>
      </div>
      <div class="mt-6">
        <div class="flex items-center justify-between px-8">
          <div class="flex flex-col items-center cursor-pointer">
            <div
              class="
                h-16
                w-16
                bg-indigo-200 bg-opacity-50
                rounded-full
                text-center text-indigo-500
              "
              style="line-height: 4.4rem"
            >
              <i class="zmdi zmdi-videocam" style="font-size: 25px"></i>
            </div>
            <h4 class="font-semibold text-md mt-2 text-gray-400">Video</h4>
          </div>
          <div class="flex flex-col items-center cursor-pointer">
            <div
              class="
                h-16
                w-16
                bg-indigo-200 bg-opacity-50
                rounded-full
                text-center text-indigo-500
              "
              style="line-height: 4.4rem"
            >
              <i class="zmdi zmdi-phone" style="font-size: 25px"></i>
            </div>
            <h4 class="font-semibold text-md mt-2 text-gray-400">Audio</h4>
          </div>
          <div class="flex flex-col items-center cursor-pointer">
            <div
              class="
                h-16
                w-16
                bg-indigo-200 bg-opacity-50
                rounded-full
                text-center text-indigo-500
              "
              style="line-height: 4.4rem"
            >
              <i class="zmdi zmdi-account" style="font-size: 25px"></i>
            </div>
            <h4 class="font-semibold text-md mt-2 text-gray-400">Profile</h4>
          </div>
        </div>
      </div>

      <div class="mt-6 pl-8">
        <h3 class="font-semibold text-gray-700 text-lg">Attachments</h3>
        <div class="mt-3 flex flex-wrap attachments " style="max-height: calc(100vh - 410px); overflow-y: auto; ">
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
          <div class="h-18 w-18 bg-gray-200 mr-1 mb-1">.</div>
        </div>
      </div>
    </div>
  </div>

  <div
    x-show="messageModel"
    class="
      messageModel
      fixed
      w-full
      h-full
      top-0
      left-0
      z-40
      bg-white
      overflow-hidden
    "
  >
    <div class="top-bar p-2 bg-indigo-500 shadow-md flex items-center">
      <div
        @click="messageModel = false"
        class="rounded-full text-center"
        style="line-height: 3rem"
      >
        <i
          class="zmdi zmdi-arrow-left text-gray-300"
          style="font-size: 27px"
        ></i>
      </div>
      <div class="left flex-1 px-2 pl-4 flex items-center">
        <div class="avagat">
          <img
            class="
              inline-block
              h-10
              w-10
              rounded-full
              ring-2 ring-white
              receiverImage
            "
            src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2.25&w=256&h=256&q=80"
            alt=""
          />
        </div>
        <div class="u_info flex flex-col items-start pl-3">
          <p class="font-bold text-xl text-gray-50 receiverName">
            Aramu Zhendra
          </p>
          <p class="text-xs text-gray-100 receiverActive">Active Now</p>
        </div>
      </div>
      <div class="right text-white flex relative items-center">
        <button class="h-8 w-8 rounded-full text-gray-100 mr-2">
          <i class="zmdi zmdi-phone" style="font-size: 22px"></i>
        </button>
        <div @click.away="open = false">
          <button
            class="
              h-8
              w-8
              rounded-full
              text-gray-100
              hover:bg-gray-200 hover:bg-opacity-25
            "
            @click="open = ! open"
          >
            <i class="zmdi zmdi-more-vert" style="font-size: 25px"></i>
          </button>

          <div
            x-show="open"
            x-transition:enter="transition ease-out duration-100"
            x-transition:enter-start="transform opacity-0 scale-95"
            x-transition:enter-end="transform opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="transform opacity-100 scale-100"
            x-transition:leave-end="transform opacity-0 scale-95"
            class="
              absolute
              right-0
              w-40
              mt-2
              origin-top-right
              rounded-md
              shadow-lg
            "
          >
            <div
              class="px-2 py-2 bg-white rounded-md shadow dark-mode:bg-gray-800"
            >
              <a
                class="
                  block
                  px-4
                  py-2
                  mt-2
                  text-gray-800 text-left text-sm
                  font-semibold
                  bg-transparent
                  rounded-lg
                  dark-mode:bg-transparent
                  dark-mode:hover:bg-gray-600
                  dark-mode:focus:bg-gray-600
                  dark-mode:focus:text-white
                  dark-mode:hover:text-white
                  dark-mode:text-gray-200
                  md:mt-0
                  hover:text-gray-900
                  focus:text-gray-900
                  hover:bg-gray-200
                  focus:bg-gray-200 focus:outline-none focus:shadow-outline
                "
                href="#"
                >View profile</a
              >
              <a
                @click="receiverInfo = true"
                class="
                  block
                  px-4
                  py-2
                  mt-2
                  text-gray-800 text-left text-sm
                  font-semibold
                  bg-transparent
                  rounded-lg
                  dark-mode:bg-transparent
                  dark-mode:hover:bg-gray-600
                  dark-mode:focus:bg-gray-600
                  dark-mode:focus:text-white
                  dark-mode:hover:text-white
                  dark-mode:text-gray-200
                  md:mt-0
                  hover:text-gray-900
                  focus:text-gray-900
                  hover:bg-gray-200
                  focus:bg-gray-200 focus:outline-none focus:shadow-outline
                "
                href="javascript:void(0)"
                >Conversation Info</a
              >

              <a
                class="
                  block
                  px-4
                  py-2
                  mt-2
                  text-gray-800 text-left text-sm
                  font-semibold
                  bg-transparent
                  rounded-lg
                  dark-mode:bg-transparent
                  dark-mode:hover:bg-gray-600
                  dark-mode:focus:bg-gray-600
                  dark-mode:focus:text-white
                  dark-mode:hover:text-white
                  dark-mode:text-gray-200
                  md:mt-0
                  hover:text-gray-900
                  focus:text-gray-900
                  hover:bg-gray-200
                  focus:bg-gray-200 focus:outline-none focus:shadow-outline
                "
                href="#"
                >Block</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="bg-white w-full m-body overflow-y-auto px-4 mt-2 message_container"
      style="max-height: calc(100vh - 220px); overflow-y: scroll"
    ></div>
    <div
      class="
        bg-white
        px-4
        h-20
        w-full
        m-foot
        absolute
        bottom-0
        shadow
        flex
        items-center
        justify-between
      "
    >
      <form class="w-full flex" id="messageForm">
        <input
          type="text"
          id="messageInput"
          autocomplete="off"
          class="
            flex-1
            bg-gray-100
            rounded-full
            text-base
            outline-none
            border-none
            text-gray-700
            py-2
            px-3
            leading-8
            transition-colors
            duration-200
            ease-in-out
          "
          placeholder="Message..."
        />
        
        <div class="buttons pl-4 flex items-center">
          <button
          @click="imageUploadModal =  true"
          type="button"
          class="mr-3 text-indigo-500 "
        >
          <i class="zmdi zmdi-image-o" style="font-size: 30px"></i>
        </button>
          <button type="button" class="picker mr-3">
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
            <svg
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 512 512"
              class="h-6 w-6"
              style="enable-background: new 0 0 512 512"
              xml:space="preserve"
            >
              <g>
                <g>
                  <path
                    style="fill: #6366f1"
                    d="M437.019,74.981C388.668,26.629,324.38,0,256,0S123.332,26.629,74.981,74.981C26.628,123.332,0,187.62,0,256
      s26.628,132.668,74.981,181.019C123.332,485.371,187.62,512,256,512s132.668-26.629,181.019-74.981
      C485.372,388.668,512,324.38,512,256S485.372,123.332,437.019,74.981z M256,481.524c-124.354,0-225.524-101.17-225.524-225.524
      S131.646,30.476,256,30.476S481.524,131.646,481.524,256S380.354,481.524,256,481.524z"
                  />
                </g>
              </g>
              <g>
                <g>
                  <path
                    style="fill: #6366f1"
                    d="M200.622,188.396c-24.953-24.955-65.556-24.953-90.509,0c-5.951,5.95-5.951,15.599,0,21.55
      c5.952,5.95,15.601,5.95,21.551,0c13.072-13.071,34.34-13.07,47.41,0c2.976,2.976,6.875,4.464,10.774,4.464
      s7.8-1.488,10.774-4.464C206.573,203.995,206.573,194.347,200.622,188.396z"
                  />
                </g>
              </g>
              <g>
                <g>
                  <path
                    style="fill: #6366f1"
                    d="M401.884,188.396c-24.953-24.953-65.556-24.955-90.509,0c-5.951,5.95-5.951,15.599,0,21.55
      c5.952,5.95,15.601,5.95,21.551,0c13.07-13.071,34.338-13.072,47.41,0c2.976,2.976,6.875,4.464,10.774,4.464
      s7.8-1.488,10.774-4.464C407.835,203.995,407.835,194.347,401.884,188.396z"
                  />
                </g>
              </g>
              <g>
                <g>
                  <path
                    style="fill: #6366f1"
                    d="M391.111,267.175H120.889c-8.416,0-15.238,6.823-15.238,15.238c0,82.902,67.447,150.349,150.349,150.349
      s150.349-67.447,150.349-150.349C406.349,273.997,399.527,267.175,391.111,267.175z M256,402.286
      c-60.938,0-111.402-45.703-118.909-104.635H374.91C367.402,356.583,316.938,402.286,256,402.286z"
                  />
                </g>
              </g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
            </svg>
          </button>
          <button id="send">
            <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
            <svg
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              class="h-6 w-6 text-indigo-500"
              viewBox="0 0 512 512"
              xml:space="preserve"
            >
              <g>
                <g>
                  <path
                    fill="#6366F1"
                    d="M481.508,210.336L68.414,38.926c-17.403-7.222-37.064-4.045-51.309,8.287C2.86,59.547-3.098,78.551,1.558,96.808
      L38.327,241h180.026c8.284,0,15.001,6.716,15.001,15.001c0,8.284-6.716,15.001-15.001,15.001H38.327L1.558,415.193
      c-4.656,18.258,1.301,37.262,15.547,49.595c14.274,12.357,33.937,15.495,51.31,8.287l413.094-171.409
      C500.317,293.862,512,276.364,512,256.001C512,235.638,500.317,218.139,481.508,210.336z"
                  />
                </g>
              </g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
              <g></g>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
  <div class="bg-indigo-500 h-24 relative rounded-bl-full"></div>


  <div style="max-height: calc(100vh - 120px); overflow-y:auto;"  class="card shadow rounded-md py-3 mx-3 bg-white -mt-16 relative z-10">
    <div
      class="
        p-4
        message_empty
        ml-2
        mt-3
        pb-16
        text-center
        bg-gray-50
        rounded-lg
      "
    >
      <div class="my-5">
        <img
          src="/images/chatting.svg"
          alt="none"
          class="max-h-40 text-center mx-auto"
        />
      </div>

      <h2 class="font-bold text-xl text-gray-600">
        Click on the User at right Users List or search users for new
        Conversation.
      </h2>

      <p class="mt-3 text-gray-400">
        Everything makes you perfect. chat unlimited time without any
        restications with anyone worldwide.
      </p>
    </div>

    <div class="p-2 message_nempty">
      <form onsubmit="event.preventDefault()" class="mt-2 relative">
        <input
          autocomplete="off"
          type="search"
          placeholder="Search..."
          id="search"
          name="search"
          class="
            w-full
            bg-white
            rounded-full
            bg-gray-100
            text-base
            outline-none
            text-gray-700
            py-1
            pl-8
            px-3
            leading-8
            transition-colors
            duration-200
            ease-in-out
          "
        />
        <span
          class="zmdi zmdi-search absolute left-3 text-gray-400 top-2.5"
          style="font-size: 20px"
        ></span>
      </form>
      <hr class="mt-2" />
      <h3 class="text-md font-bold text-gray-500 mt-2 mb-2">
        Favourates <i class="zmdi zmdi-heart"></i>
      </h3>
      <div class="lists mb-2 w-full flex overflow-x-auto">
        <% chats.forEach(function(chat,index){ %> <% if(index < 15){ %>

        <div
          class="
            item-<%=
            index
            %>
            mr-2
            flex flex-col
            items-center
            justify-center
            max-w-12
          "
        >
          <div class="relative h-16 w-16 min-w-16">
            <img
              class="inline-block w-full h-full rounded-full ring-2 ring-white"
              src="<%= chat.sender._id == userId ? chat.receiver.picture : chat.sender.picture; %>"
              alt=""
            />

            <div
              class="
                absolute
                border-2 border-white
                h-4
                w-4
                <%
                if(chat.sender._id
                ==
                userId){
                %>
                <%=
                chat.receiver.online
                ?
                'bg-green-500'
                :
                'bg-gray-100'
                %>
                <%
                }else
                {
                %>
                <%=
                chat.sender.online
                ?
                'bg-green-500'
                :
                'bg-gray-200'
                %>
                <%
                }
                %>
                rounded-full
              "
              style="right: 0; bottom: 0"
            >
              .
            </div>
          </div>
          <h5
            style="max-width: 60px"
            class="
              n
              text-gray-400 text-sm
              truncate
              overflow-ellipsis overflow-hidden
              max-w-6
            "
          >
            <%= chat.sender._id == userId ? chat.receiver.name :
            chat.sender.name; %>
          </h5>
        </div>

        <% } }) %>
      </div>
    </div>
    <nav id="c_list">
      <% chats.forEach(function(chat,index){ var currentUnread =
      unreadCount[index].split('-'); %>
      <!-- http://192.168.43.147:8000/user/2_user_profile_loaded.png -->
      <a
        onclick="changeActiveUser('<%= chat.sender._id == userId ? chat.receiver._id : chat.sender._id;  %>', '<%= chat.conversationId %>', this)"
        @click="messageModel = true"
        class="
          block
          px-4
          py-4
          border-b border-gray-200
          text-sm
          font-semibold
          text-gray-900
          bg-transparent
          dark-mode:bg-transparent
          dark-mode:hover:bg-gray-600
          dark-mode:focus:bg-gray-600
          dark-mode:focus:text-white
          dark-mode:hover:text-white
          dark-mode:text-gray-200
          hover:text-gray-900
          focus:text-gray-900
          hover:bg-gray-100
          focus:bg-gray-100 focus:outline-none focus:shadow-outline
          <%=
          chat.conversationId
          %>
        "
        href="#"
      >
        <div class="flex items-center -space-x-1 overflow-hidden">
          <div class="relative h-12 w-12 min-w-12">
            <img
              class="inline-block w-full h-full rounded-full ring-2 ring-white"
              src="<%= chat.sender._id == userId ? chat.receiver.picture : chat.sender.picture; %>"
              alt=""
            />

            <div
              class="
                absolute
                border-2 border-white
                h-4
                w-4
                <%
                if(chat.sender._id
                ==
                userId){
                %>
                <%=
                chat.receiver.online
                ?
                'bg-green-500'
                :
                'bg-gray-100'
                %>
                <%
                }else
                {
                %>
                <%=
                chat.sender.online
                ?
                'bg-green-500'
                :
                'bg-gray-200'
                %>
                <%
                }
                %>
                rounded-full
              "
              style="right: 0; bottom: 0"
            >
              .
            </div>
          </div>
          <div class="pl-3 flex flex-col flex-1">
            <div class="flex flex-row items-center justify-between w-full">
              <div class="font-bold text-lg capitalize conid">
                <%= chat.sender._id == userId ? chat.receiver.name :
                chat.sender.name; %>
              </div>
              <div class="text-gray-400 uppercase text-sm">
                <% d = chat.receiver.last_active; var date = new
                Date(parseInt(d)).toLocaleTimeString(); a =
                date.substring(date.length - 2); b = date.substring(0,
                date.length - 6); tim= b+ ' '+ a %> <%= tim %>
              </div>
            </div>
            <div class="flex items-start justify-between">
              <div
                class="
                  text-gray-500
                  truncate
                  overflow-ellipsis
                  mssg
                  overflow-hidden
                "
                style="width: 50%; max-width: 150px"
              >
                <%= chat.sender._id == userId ? 'you: '+chat.message :
                chat.message %>
              </div>

              <span
                class="
                  bg-red-300
                  text-gray-700 text-sm
                  px-1
                  rounded-full
                  unseen
                "
              >
                <%= currentUnread[1] > 0? currentUnread[1] : '' %>
              </span>
            </div>
          </div>
        </div>
      </a>

      <% }) %>
    </nav>
  </div>

  <div
  x-show="imageUploadModal"
  class="
    imageUploadModal
    fixed
    top-0
    left-0
    z-50
    w-screen
    h-screen
    grid
    items-center
    p-4
    bg-white bg-opacity-50
  "
>
  <div
    class=" inneru bg-white rounded-lg w-full lg:w-1/2 h-auto mx-auto"
  >
    <div
      class="
        extraOutline
        p-4
        bg-white
        w-max
        bg-whtie
        m-auto
        rounded-lg
        shadow-md
      "
    >
      <div
        class="
          file_upload
          p-5
          relative
          border-4 border-dotted border-gray-300
          rounded-lg min-w-xl
        "
        style="max-width: 400px; min-width: 290px;"
      >
        <svg
          class="text-indigo-500 w-24 mx-auto mb-4"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
          />
        </svg>
        <div class="input_field flex flex-col w-max mx-auto text-center">
          <label>
            <input
              class="text-sm cursor-pointer w-36 hidden"
              type="file"
              id="mobile-file-upload"
              accept="image/jpg,image/jpeg,image/png,image/webp"
            />
            <div
              class="
                text
                bg-indigo-600
                text-white
                border border-gray-300
                rounded
                font-semibold
                cursor-pointer
                p-1
                px-3
                hover:bg-indigo-500
              "
            >
              Select Image
            </div>
          </label>

          <div class="title text-indigo-500 uppercase ">
            <img src=""  alt="" class=" file-preview border-none mt-3 max-w-full w-auto max-h-32 rounded-lg shadow-md"  >

          </div>
        </div>

        <div class="absolute bottom-0 right-0  ">
          <button @click="imageUploadModal = !imageUploadModal" class="px-4 py-1 hidden mobile-upload-btn rounded-full upload-btn shadow bg-indigo-400 text-white hover:bg-indigo-500 m-2">upload</button>
        </div>

        <div
          @click="imageUploadModal = false"
          class="
          bg-red-500 text-white
            close_btn
            absolute
            -top-10
            -right-10
            bg-white
            p-4
            cursor-pointer
            hover:bg-gray-100
            py-2
            hover:text-gray-600
            rounded-full
          "
        >
          X
        </div>
      </div>
    </div>
  </div>
</div>
  <script>
    var arrm = document.querySelectorAll(".mobile #c_list > a");
    function searchh(e) {
      let string = e.target.value.toLowerCase();

      arrm.forEach((item, i) => {
        var itext = item.querySelector(".conid").innerText.trim().toLowerCase();
        console.log(itext);
        if (itext.startsWith(string)) {
          item.style.display = "block";
        } else {
          item.style.display = "none";
        }
      });
    }

    document
      .querySelector(".mobile #search")
      .addEventListener("input", searchh);
  </script>
</div>
